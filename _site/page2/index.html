<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      will chan's random blog &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>I'm a software engineer working at <a href="http://www.paxata.com/">Paxata</a>. I write about random things here.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
  </nav>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://github.com/williamchan">github</a>
  </nav>
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://www.linkedin.com/in/williamchan">linkedin</a>
  </nav>
  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="https://twitter.com/w1zz1e">twitter</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59151560-1', 'williamchan.github.io');
  ga('send', 'pageview');

</script>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">will chan's random blog</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/06/11/rear-view-of-my-egraphs-experience/">
        A rear view of my Egraphs experience
      </a>
    </h1>

    <span class="post-date">11 Jun 2013</span>

    <p>It’s been over a month since we <a href="http://www.insidesocal.com/tomhoffarth/2013/05/02/why-egraphs-finally-had-to-sign-off/">shuttered Egraphs</a>. I waited a while before writing to give myself some distance, since the last months of Egraphs were often quite painful as we weighed whether and how to end the company and how to navigate when the end seemed near.</p>

<p>I have a lot of warm memories about this period in my life. I recall that, before launch, we worried over whether we would sell a single Egraph to someone not related to us. And to be honest, up until then had I felt like we were building a toy. I found it extremely gratifying once we saw how meaningful it was that our customers could interact with their heroes and that they did so using our service. In the words of Tony Hsieh, we were in the business of <a href="http://www.amazon.com/Delivering-Happiness-Profits-Passion-Purpose/dp/160941280X">delivering happiness</a>, and our company was about delivering happiness to both our customers and to ourselves. We didn’t do things perfectly, but I would give ourselves passing grades and no regrets.</p>

<p>You learn a lot the first time you start a company. Of course, I gained a lot of coding experience from developing a website from scratch while working full-stack. I learned Scala, the language we chose for the server codebase. I also learned about hiring and building a company culture and about iterating — the sort of stuff that is often discussed at startup speaking events. (By the way, <a href="http://gettingreal.37signals.com/">Getting Real</a>, a book on product management by 37signals, is a really great read for anyone building a company or product.)</p>

<p>I also learned things that I don’t ever recall being discussed at startup events. The most important lesson has to do with, what is the proper relationship between founders and their board? In the context of a startup, a board’s first priority may be toward their investment, whereas the founder’s priority is to the success of the company. This is a subtle but potentially substantial difference. Company management needs to do what it takes to make the company successful and not just what the board wants them to do. I wouldn’t be surprised if many first-time entrepreneurs don’t realize this at the beginning of their startup journeys. I think it takes experience and it definitely takes confidence.</p>

<p>Finally, I want the next company I found to be one that I want to devote a career to. Entrepreneurship is hard and rough patches should be expected. When the going gets tough, I want a sense of mission to carry me through those rough patches. “Work on what you’re passionate about” is advice that is often passed around the startup community, and I believe it even more now to a degree that would not have been possible before my Egraphs experience.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/03/04/simple-scala-habits-saved-us-on-launch/">
        Simple Scala habits saved us on launch
      </a>
    </h1>

    <span class="post-date">04 Mar 2013</span>

    <p>Months after it happened, the launch of Egraphs still feels like a blur. There was the crazy rush to finish the site in the weeks leading up, publishing the site from Tropicana Field as the Rays played the Red Sox, and watching baseball fans show up and actually start spending money.</p>

<p>I would have preferred to avoid any development death marches, but we were committed to July 12 because we were working with external partners including the MLB, the Rays, and an initial lineup of celebrity partners including David Ortiz and Pedro Martinez. How many startups out can say that they have so much support on day one?</p>

<p>One thing that naturally occurred is that we stopped writing tests in the six weeks leading up to launch. It’s not something I’m proud of, but amazingly the site didn’t croak when customers started using it. We saw zero null pointer exceptions and very few logic bugs, and I attribute that to easy Scala habits we adopted to great effect.</p>

<p>For example, to achieve null-safety, we avoided calling Option.get like the plague. Scala allows you to access objects that might or might have been instantiated with map, or match, or for-comprehension. That one habit is responsible for the rarity of NPEs for us.</p>

<p>Secondly, we relied on type-safety as much as possible. If branching on the state of something to determine which logic path to execute, we got specific with types. It’s a beautiful thing to be able to write a lot of code and feel confident that if it compiles, then it likely works.</p>

<p>(Code examples of these simple Scala habits can be found in <a href="http://www.slideshare.net/willchan83/scala-at-egraphs-sept-2012">this presentation</a>.)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/03/04/building-faceted-search-with-postgresql/">
        Building Faceted Search With PostgreSQL
      </a>
    </h1>

    <span class="post-date">04 Mar 2013</span>

    <p><a href="https://web.archive.org/web/20130318235943/http://tech.pro/tutorial/1142/building-faceted-search-with-postgresql">Siggy wrote a great post about how he built our fully-functional marketplace</a>. It’s pretty cool how quickly things can come together with just one engineer making good decisions and using cool technologies.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/03/02/controller-filters-in-play-and-scala/">
        Controller filters in Play and Scala
      </a>
    </h1>

    <span class="post-date">02 Mar 2013</span>

    <p>We were chilling with other students enrolled in the coursera Scala class wondering aloud why one would ever use <a href="https://en.wikipedia.org/wiki/Currying">currying</a>. Admittedly, the ability to organize parameter lists for your functions feels somewhat academic, but we have managed to use function currying in ways that we’re really happy with.</p>

<p>In our web app, we have many controllers that respond to different kinds of requests. Some of those controllers respond to simple GET requests that are not expected to alter state on the server. Some respond to POST requests that are expected to change state and also check CSRF tokens. And some other controllers respond to POST requests to Api endpoints for which CSRF tokens are not relevant.</p>

<p>We have a class called ControllerMethod that is flexible enough to handle these general types of requests whether GET or POST or Api POST, and yet can be tailored with the specific logic that should execute for that route.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">ControllerMethod</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">def</span> <span class="nx">apply</span><span class="p">[</span><span class="nx">A</span><span class="p">](</span><span class="nx">dbSettings</span><span class="o">:</span> <span class="nx">ControllerDBSettings</span> <span class="o">=</span> <span class="nx">WithoutDBConnection</span><span class="p">)</span>
              <span class="p">(</span><span class="nx">action</span><span class="o">:</span> <span class="nx">Action</span><span class="p">[</span><span class="nx">A</span><span class="p">])</span><span class="o">:</span> <span class="nx">Action</span><span class="p">[</span><span class="nx">A</span><span class="p">]</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="nx">Action</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">parser</span><span class="p">)</span> <span class="p">{</span> <span class="nx">request</span> <span class="o">=&gt;</span>
      <span class="nx">dbSettings</span> <span class="nx">match</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">WithoutDBConnection</span> <span class="o">=&gt;</span> <span class="nx">action</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
          <span class="p">...</span> <span class="nx">other</span> <span class="nx">cases</span> <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Treating ControllerMethod as a “root method” for controllers, we can use it to streamline our controllers like, for example, the one that returns an egraph:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">def</span> <span class="nx">getEgraph</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">Long</span><span class="p">)</span> <span class="o">=</span> <span class="nx">controllerMethod</span> <span class="p">{</span>
  <span class="nx">Action</span> <span class="p">{</span> <span class="nx">implicit</span> <span class="nx">request</span> <span class="o">=&gt;</span>
    <span class="nx">egraphStore</span><span class="p">.</span><span class="nx">findFulfilledEgraph</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="nx">match</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nx">Some</span><span class="p">(</span><span class="nx">egraph</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Ok</span><span class="p">(</span><span class="nx">renderEgraphPage</span><span class="p">(</span><span class="nx">egraph</span><span class="p">))</span>
      <span class="k">case</span> <span class="nx">None</span> <span class="o">=&gt;</span> <span class="nx">NotFound</span><span class="p">(</span><span class="s2">&quot;No Egraph found&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This simple pattern eliminates tons of boilerplate code that would otherwise need to be written into each controller. Moreover, the POST controller that handles changes applied to an egraph uses a slightly modified version of controllerMethod. So with minimal variation in code, we treat the POST controller with functionality that you would expect to have, such as a writable database context and protected against CSRF attacks.</p>

<p>Currying is not a technique I envisioned using much when I was first introduced to it. But as we matured as Scala devs and left old Java habits behind, we have used this technique to write dozens of controllers (and other classes) across our web app. Based on experience, currying has proven to be an extremely powerful pattern for bringing organizational sanity to our codebase. =)</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/03/01/learning-managing-servers/">
        Learning like a 5yo about managing servers
      </a>
    </h1>

    <span class="post-date">01 Mar 2013</span>

    <p>I think writing software is fun. Less fun is stressing out when the servers running your code crap out. As tech teams go, my compatriots and I are more app developers than tech ops/dev ops/whatever. Our first several months of running a site were more eventful than I was hoping.</p>

<p>First, there was a <a href="http://aws.amazon.com/message/67457/">huge AWS outage in June</a> that took out both our app servers and our database servers several days before our launch date. On our launch date, we roundhouse kicked our own site when we reacted to high traffic by spinning up too many app servers and <a href="http://www.postgresql.org/docs/current/static/runtime-config-connection.html#GUC-MAX-CONNECTIONS">accidentally overloading the number of available database connections</a>... we now know better. Excitement of this sort continued for a few months as we continued to have site issues almost every week.</p>

<p>A few doozies were particularly memorable.</p>

<p>One night during what should have been a routine deployment, I ran an upgrade script to change the database from version 23 to 24. Then I tried to deploy new app code, but the app servers failed to start because of inconsistent database version, and that was a non-starter for a website built on the Play 1.2 framework. That’s funny, how could that possibly be? I double-checked that the database schema was the correct version, and yet the app servers failed to start several more times. Meanwhile, our site is down and I start to hyperventilate because I feel crazy. I down a bottle of pinot noir to stave off a heart attack. Eventually, I noticed that the database’s load balancer incorrectly reported version 23 while the database itself was on version 24.</p>

<p>So replication was broken!! <a href="http://www.pgpool.net/mediawiki/index.php/Main_Page">Our database load balancer</a> diverts many SELECT queries to the replica, which was still a version behind, and that incorrect version was what the application read. To fix the site, I pointed the application directly at the master database instead of at the load balancer, thereby cutting the replica out of the picture. And we ran our site directly on the master database for the next few days until we fixed replication. The whole ordeal probably lasted less than an hour, but time slows down to make it feel much longer. I swore to never write non-backward-compatible schema changes no matter how trivial a column rename feels, and to always keep a bottle of pinot on hand.</p>

<p>Doozy #2 is a story from a day when MLB sent emails to millions of baseball fans on our behalf. It was to be our highest traffic day yet, and <a href="http://developer-blog.cloudbees.com/2013/01/play-framwork-our-most-popular.html">it went a bit like this</a> except that our site was much less prepared. In the earlier part of the day some visitors to our site were experiencing half-minute page loads omgz =(. It turned out that a CSS styles file was often taking a long time to download even though we had just started using <a href="http://aws.amazon.com/cloudfront/">Amazon’s Cloudfront CDN</a> to serve that file, implying that Cloudfront was making roundtrips to the application server. We increased the cache period of that asset on Cloudfront, and that little change got our site back to loading pages within a second even under load! Actually it was our friends at <a href="https://www.cloudbees.com/">CloudBees</a>, our app server PaaS vendor, who made that observation.</p>

<p>And there are more stories like that chronicled in wiki pages that we write about each site incident.</p>

<p>Learning occurred, to say the least. But probably the most valuable thing I learned was not any technical kernel of knowledge but rather how to not freak out about site issues. They’re going to happen when you run a web business. The key is to chill out and use them as training moments, especially while our site is still young.</p>

<p>Despite all of this, I’ve calculated out that we maintained &gt;99.98% uptime. Not bad for a few app developers, if I do say so myself.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
